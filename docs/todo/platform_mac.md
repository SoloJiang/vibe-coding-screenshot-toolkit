# platform_mac 模块 todo

## 当前状态
- ✅ 交互式框选截图基础实现：基于 ui_overlay 的区域选择 + 截图裁剪
- ✅ 剪贴板写入 PNG
- ✅ 多显示器检测和虚拟桌面坐标系统
- ✅ 跨显示器区域选择支持：扩展选择器以支持跨越多个显示器的区域
- ✅ 虚拟桌面坐标系统：统一处理多显示器的坐标映射
- ✅ 显示器元数据增强：记录详细的显示器信息（DPI、位置关系等）
- ✅ 多显示器合成截图：真正的 capture_all 实现
- ✅ 智能截图策略：单显示器优化 vs 跨显示器合成

## 多显示器功能完善 (优先级 M1)
- ✅ 跨显示器区域选择支持
- ✅ 虚拟桌面坐标系统
- ✅ 显示器元数据增强
- ✅ 智能截图处理逻辑
- [ ] 动态显示器配置处理：支持显示器热插拔的场景
- [ ] 虚拟桌面缓存优化：避免重复全屏合成
- [ ] 跨显示器选择的用户体验优化：可视化指示跨显示器区域

## 性能优化 (优先级 M2)
- [ ] 大尺寸虚拟桌面内存优化：流式处理大区域截图
- [ ] 显示器检测缓存：避免频繁重新检测
- [ ] 权限检测优化：improve_screen_capture_permission_check
- [ ] 错误消息国际化：提供更友好的错误提示
- [ ] 多线程并行捕获：同时捕获多个显示器

## 用户体验增强 (优先级 M2)
- [ ] 跨显示器选择预览：在主显示器上显示虚拟桌面缩略图
- [ ] 显示器边界可视化：在选择时显示显示器边界线
- [ ] 选择区域跨显示器提示：实时显示跨越的显示器数量
- [ ] 键盘快捷键：支持精确像素级调整

## 高级功能 (优先级 M3+)
- [ ] ScreenCaptureKit 集成：作为 xcap 的替代方案（macOS 12.3+）
- [ ] 窗口捕获支持：扩展到窗口级别的截图
- [ ] 光标捕获：在截图中包含鼠标光标
- [ ] 视频录制支持：扩展到多显示器视频录制
- [ ] HDR 显示器支持：处理高动态范围显示器

## 已完成的功能清理
- ✅ 移除 capture_full 方法的简化实现，改为真正的全虚拟桌面
- ✅ 移除 capture_region 方法（已被交互式选择替代）
- ✅ 移除 mock 相关逻辑
- ✅ 实现完整的多显示器架构

## 测试用例 (当前需要)
- [ ] 单显示器交互选择测试
- [ ] 多显示器环境检测测试
- [ ] 跨显示器区域选择测试
- [ ] 虚拟桌面坐标转换测试
- [ ] 显示器配置变化适应性测试
- [ ] 性能基准测试（单显示器 vs 跨显示器）
- [ ] 边界情况测试（负坐标、显示器间隙等）

## 技术债务
- [ ] 完善单元测试覆盖率
- [ ] 文档注释完善（特别是虚拟桌面相关API）
- [ ] XCap 版本跟踪和更新
- [ ] 错误处理标准化（统一使用 screenshot_core::Error）

## 已知限制
- 当前交互界面限制在主显示器上（技术上可扩展到任意显示器）
- 虚拟桌面合成在大尺寸配置下可能消耗较多内存
- 依赖 xcap 的显示器元数据准确性

## 未来扩展方向
- 支持 ScreenCaptureKit 的新特性（macOS 13+）
- 扩展到 iOS/iPadOS 的多屏支持
- 集成机器学习的智能区域推荐
