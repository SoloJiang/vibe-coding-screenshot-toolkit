# 产品需求文档 (PRD) - 跨平台截图与标注工具

文档版本：v2.0
产品定位：跨平台截图与标注工具，当前聚焦交互式区域选择能力

---

## 1. 产品概述

### 1.1 产品目标
- 提供高质量的交互式截图体验
- 支持多平台（macOS/Windows）和多显示器环境
- 简洁高效的操作流程
- 为未来的标注编辑功能打好基础

### 1.2 版本规划

#### v0.1（当前版本）- 交互式截图核心
专注于截图捕获和区域选择的核心能力：
- ✅ 交互式区域选择
- ✅ 多显示器支持
- ✅ 跨显示器区域选择
- ✅ PNG 导出和剪贴板
- ✅ 智能文件命名

#### v0.2（规划中）- 标注编辑系统
增加标注编辑能力，对标微信截图：
- ⏳ 标注工具栏 UI
- ⏳ 实时绘制交互
- ⏳ 矩形、箭头、画笔工具
- ⏳ 颜色和粗细选择
- ⏳ 撤销/重做操作

#### v0.3+（远期）- 高级功能
- 文字标注输入
- 马赛克和高亮
- 历史记录管理
- 插件系统

### 1.3 核心功能模块（当前版本）
| 模块 | 功能 | 状态 |
|------|------|------|
| CAP | 截图捕获 | ✅ 完成 |
| SEL | 区域选择器 | ✅ 完成 |
| MULTI | 多显示器支持 | ✅ 完成 |
| EXP | 导出功能 | ✅ 完成 |
| ANO | 标注数据模型 | ✅ 完成 |
| EDIT | 标注编辑 UI | ⏳ 规划中 |

---

## 2. 当前功能需求（v0.1）

### 2.1 CAP - 截图捕获
| 编号 | 功能 | 用户故事 | 触发方式 | 验收标准 | 状态 |
|------|------|----------|----------|----------|------|
| CAP-01 | 交互式截图 | 我想通过可视化界面选择截图区域 | `capture-interactive` 命令 | 启动 GUI 界面，支持区域选择 | ✅ |
| CAP-02 | 虚拟桌面截图 | 我想获取整个虚拟桌面的内容 | 自动后台执行 | 捕获所有显示器的完整内容 | ✅ |
| CAP-03 | 区域裁剪 | 我想精确裁剪选中的区域 | 选择确认后自动执行 | 按选中区域精确裁剪 | ✅ |

### 2.2 SEL - 区域选择器
| 编号 | 功能 | 用户故事 | 交互方式 | 验收标准 | 状态 |
|------|------|----------|----------|----------|------|
| SEL-01 | 可视化选择 | 我需要直观的区域选择界面 | GUI 覆盖层 | 覆盖所有显示器，提供清晰界面 | ✅ |
| SEL-02 | 区域选择 | 我想通过鼠标选择截图区域 | 鼠标拖拽 | 支持任意矩形区域选择 | ✅ |
| SEL-03 | 实时预览 | 我想看到当前选择的区域效果 | 选择过程中显示 | 选中区域高亮，其他区域半透明 | ✅ |
| SEL-04 | 键盘控制 | 我想通过键盘快速操作 | 键盘快捷键 | ESC 取消，Enter 确认，Shift/Alt 辅助 | ✅ |
| SEL-05 | 修饰键支持 | 我想固定比例或中心拉伸 | Shift/Alt 键 | Shift 正方形，Alt 中心拉伸 | ✅ |

### 2.3 MULTI - 多显示器支持
| 编号 | 功能 | 用户故事 | 实现方式 | 验收标准 | 状态 |
|------|------|----------|----------|----------|------|
| MULTI-01 | 显示器检测 | 系统自动识别所有显示器 | xcap API 调用 | 正确获取显示器数量和属性 | ✅ |
| MULTI-02 | 多屏界面 | 选择界面覆盖所有显示器 | GUI 跨显示器 | 每个显示器都有完整界面 | ✅ |
| MULTI-03 | 坐标处理 | 正确处理多显示器坐标系 | 虚拟桌面映射 | 截图坐标准确无误 | ✅ |
| MULTI-04 | 跨屏选择 | 我想选择跨越多个显示器的区域 | 支持跨屏拖拽 | 可选择跨显示器边界的区域 | ✅ |

### 2.4 EXP - 导出功能
| 编号 | 功能 | 用户故事 | 操作方式 | 验收标准 | 状态 |
|------|------|----------|----------|----------|------|
| EXP-01 | PNG 保存 | 我想将截图保存为文件 | 自动保存 | 生成高质量 PNG 文件 | ✅ |
| EXP-02 | 剪贴板复制 | 我想将截图复制到剪贴板 | --clipboard 参数 | 可在其他应用中粘贴 | ✅ |
| EXP-03 | 智能命名 | 我想要有意义的文件名 | 基于时间模板命名 | 文件名格式可配置 | ✅ |

---

## 3. 未来功能需求（v0.2+）

### 3.1 EDIT - 标注编辑系统（规划中）
| 编号 | 功能 | 用户故事 | 操作方式 | 目标版本 |
|------|------|----------|----------|----------|
| EDIT-01 | 工具栏 UI | 我想看到可用的标注工具 | 浮动工具栏 | v0.2 |
| EDIT-02 | 矩形标注 | 我想在截图上添加矩形框 | 拖拽绘制 | v0.2 |
| EDIT-03 | 箭头标注 | 我想用箭头指示重要内容 | 起点终点拖拽 | v0.2 |
| EDIT-04 | 撤销重做 | 我想撤销错误的标注操作 | Ctrl+Z / Ctrl+Y | v0.2 |
| EDIT-05 | 颜色选择 | 我想自定义标注颜色 | 颜色选择器 | v0.2 |
| EDIT-06 | 画笔工具 | 我想自由绘制标记 | 鼠标自由绘制 | v0.2 |
| EDIT-07 | 文本标注 | 我想添加文字说明 | 点击输入文本 | v0.3 |
| EDIT-08 | 马赛克 | 我想模糊敏感信息 | 选择区域应用马赛克 | v0.3 |

---

## 4. 技术要求

### 4.1 性能要求
- 启动延迟：< 500ms
- 界面响应：< 50ms
- 截图处理：< 1s
- 内存使用：< 100MB（无标注编辑时）
- GPU 渲染：60fps 流畅度

### 4.2 兼容性要求
- macOS 10.15+（当前版本完整支持）
- Windows 10+（基础框架已就绪）
- 支持 Retina/高 DPI 显示器
- 支持多种显示器配置（横向、纵向、混合排列）

### 4.3 质量要求
- 截图无损质量
- HiDPI 正确适配
- 颜色准确性
- 文件格式兼容性

---

## 5. 用户体验

### 5.1 交互式截图流程（v0.1 当前实现）
1. 用户执行 `capture-interactive` 命令
2. 系统检测所有显示器并捕获虚拟桌面截图
3. 显示覆盖全屏的选择界面（暗化背景）
4. 用户通过鼠标拖拽选择截图区域
   - 支持 Shift 固定比例
   - 支持 Alt 中心拉伸
   - 支持 ESC 取消，Enter/Space 确认
5. 系统裁剪选中区域并导出
6. 自动保存到文件和/或复制到剪贴板

### 5.2 标注编辑流程（v0.2 规划）
1. 区域选择完成后进入编辑模式
2. 显示工具栏（矩形/箭头/画笔/文本/马赛克）
3. 选择工具并在截图上绘制标注
4. 支持颜色选择、粗细调节
5. 支持撤销/重做操作
6. 点击"完成"导出带标注的图像
7. 点击"取消"丢弃标注并退出

---

## 6. 验收标准

### 6.1 v0.1 功能验收（当前版本）
- ✅ 可以成功启动交互式选择界面
- ✅ 支持多显示器环境的检测和选择
- ✅ 支持跨显示器区域选择
- ✅ 选择界面流畅无卡顿（60fps）
- ✅ 截图坐标准确，裁剪精确
- ✅ PNG 导出质量正常
- ✅ 剪贴板功能正常工作
- ✅ 错误提示友好（权限、取消等）

### 6.2 v0.2 功能验收（规划）
- [ ] 编辑模式正常进入和退出
- [ ] 工具栏显示正确，交互流畅
- [ ] 标注绘制实时预览
- [ ] 撤销/重做功能正常
- [ ] 最终导出包含所有标注

### 6.3 性能验收
- ✅ 启动时间 < 500ms
- ✅ 选择界面响应 < 50ms
- ✅ 截图处理 < 1s（4K 分辨率）
- ✅ 内存使用合理（< 100MB）
- ✅ GPU 渲染流畅（60fps）

### 6.4 稳定性验收
- ✅ 连续使用无崩溃
- ✅ 多显示器配置切换稳定
- ✅ 错误场景优雅处理（权限拒绝、用户取消）

---

## 7. 发展规划

### 7.1 v0.1 - 交互式截图核心（已完成）
- 多显示器区域选择
- GPU 加速渲染
- 基础导出功能

### 7.2 v0.2 - 标注编辑系统（开发中）
- 工具栏 UI
- 基础标注工具（矩形、箭头、画笔）
- 撤销/重做

### 7.3 v0.3 - 完善标注功能
- 文字输入
- 马赛克和高亮
- 高级编辑功能

### 7.4 v1.0 - 完整产品
- Windows 平台完整支持
- 历史记录管理
- 快捷键全局绑定
- 插件系统
