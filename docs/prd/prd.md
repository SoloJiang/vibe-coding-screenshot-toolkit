# 产品需求文档 (PRD) - 跨平台截图与标注工具

文档版本：v2.0
产品定位：跨平台截图与标注工具，支持交互式选择和多显示器环境

---

## 1. 产品概述

### 1.1 产品目标
- 提供高质量的截图与标注一体化体验
- 支持多平台（macOS/Windows）和多显示器环境
- 简洁高效的操作流程
- 原生系统集成体验

### 1.2 核心功能模块
| 模块 | 功能 | 说明 |
|------|------|------|
| CAP | 截图捕获 | 支持全屏、区域、交互式选择三种模式 |
| SEL | 区域选择器 | 提供精确的交互式区域选择界面 |
| ANO | 标注系统 | 矩形、箭头、文本等标注工具 |
| EXP | 导出功能 | PNG 格式保存和剪贴板复制 |
| MULTI | 多显示器支持 | 检测和处理多显示器环境 |
| CROSS | 跨平台支持 | macOS 和 Windows 统一接口 |

---

## 2. 功能需求

### 2.1 CAP - 截图捕获
| 编号 | 功能 | 用户故事 | 触发方式 | 验收标准 |
|------|------|----------|----------|----------|
| CAP-01 | 交互式截图 | 我想通过可视化界面选择截图区域 | `capture-interactive` 命令 | 启动 GUI 界面，支持区域选择 |
| CAP-02 | 全屏截图 | 我想快速获取整个屏幕内容 | `capture` 命令 | 获得完整屏幕截图 |
| CAP-03 | 区域截图 | 我想精确截取指定坐标区域 | `capture-region --rect x,y,w,h` | 按指定坐标裁剪图像 |
| CAP-04 | 多显示器截图 | 我想获取所有显示器的内容 | `capture --all` | 识别并截取所有显示器 |

### 2.2 SEL - 区域选择器
| 编号 | 功能 | 用户故事 | 交互方式 | 验收标准 |
|------|------|----------|----------|----------|
| SEL-01 | 可视化选择 | 我需要直观的区域选择界面 | GUI 覆盖层 | 覆盖所有显示器，提供清晰界面 |
| SEL-02 | 区域选择 | 我想通过鼠标选择截图区域 | 鼠标拖拽 | 支持任意矩形区域选择 |
| SEL-03 | 实时预览 | 我想看到当前选择的区域效果 | 选择过程中显示 | 选中区域高亮，其他区域半透明 |
| SEL-04 | 精确调整 | 我想微调选择的区域边界 | 拖拽边框/角落 | 支持精确的区域边界调整 |
| SEL-05 | 键盘控制 | 我想通过键盘快速操作 | 键盘快捷键 | ESC 取消，Enter 确认 |

### 2.3 ANO - 标注系统
| 编号 | 功能 | 用户故事 | 操作方式 | 验收标准 |
|------|------|----------|----------|----------|
| ANO-01 | 矩形标注 | 我想在截图上添加矩形框 | 拖拽绘制 | 支持颜色、线宽、圆角自定义 |
| ANO-02 | 箭头标注 | 我想用箭头指示重要内容 | 起点终点拖拽 | 支持实线/虚线，箭头大小可调 |
| ANO-03 | 文本标注 | 我想添加文字说明 | 点击输入文本 | 支持字体、大小、颜色自定义 |
| ANO-04 | 撤销重做 | 我想撤销错误的标注操作 | Ctrl+Z / Ctrl+Y | 支持多级撤销和重做 |
| ANO-05 | 图层管理 | 我想调整标注的层级顺序 | 右键菜单 | 支持置顶、置底、上移、下移 |

### 2.4 EXP - 导出功能
| 编号 | 功能 | 用户故事 | 操作方式 | 验收标准 |
|------|------|----------|----------|----------|
| EXP-01 | PNG 保存 | 我想将截图保存为文件 | 自动保存或手动保存 | 生成高质量 PNG 文件 |
| EXP-02 | 剪贴板复制 | 我想将截图复制到剪贴板 | 自动复制 | 可在其他应用中粘贴 |
| EXP-03 | 智能命名 | 我想要有意义的文件名 | 基于时间模板命名 | 文件名格式可配置 |
| EXP-04 | 带标注导出 | 我想导出包含标注的最终图像 | 标注合成渲染 | 标注正确叠加在截图上 |

### 2.5 MULTI - 多显示器支持
| 编号 | 功能 | 用户故事 | 实现方式 | 验收标准 |
|------|------|----------|----------|----------|
| MULTI-01 | 显示器检测 | 系统自动识别所有显示器 | 系统 API 调用 | 正确获取显示器数量和属性 |
| MULTI-02 | 多屏界面 | 选择界面覆盖所有显示器 | GUI 跨显示器 | 每个显示器都有完整界面 |
| MULTI-03 | 坐标处理 | 正确处理多显示器坐标系 | 虚拟桌面映射 | 截图坐标准确无误 |
| MULTI-04 | 跨屏选择 | 我想选择跨越多个显示器的区域 | 支持跨屏拖拽 | 可选择跨显示器边界的区域 |

### 2.6 CROSS - 跨平台支持
| 编号 | 功能 | 用户故事 | 实现方式 | 验收标准 |
|------|------|----------|----------|----------|
| CROSS-01 | macOS 支持 | 我想在 macOS 上使用完整功能 | 基于 xcap 和 NSPasteboard | 所有功能正常工作 |
| CROSS-02 | Windows 支持 | 我想在 Windows 上使用相同功能 | Windows API 实现 | 功能对等，接口统一 |
| CROSS-03 | 统一接口 | 代码在不同平台上行为一致 | trait 抽象 | 平台差异对用户透明 |

---

## 3. 技术要求

### 3.1 性能要求
- 启动延迟：< 500ms
- 界面响应：< 50ms
- 截图处理：< 1s
- 内存使用：< 100MB
- 标注操作：< 16ms

### 3.2 兼容性要求
- macOS 10.15+
- Windows 10+
- 支持 Retina/高 DPI 显示器
- 支持多种显示器配置

### 3.3 质量要求
- 截图无损质量
- 标注渲染抗锯齿
- 颜色准确性
- 文件格式兼容性

---

## 4. 用户体验

### 4.1 基础截图流程
1. 用户执行截图命令
2. 系统检测显示器配置
3. 执行相应的截图操作
4. 自动保存和复制到剪贴板

### 4.2 交互式截图流程
1. 用户执行 `capture-interactive`
2. 显示覆盖全屏的选择界面
3. 用户通过鼠标选择截图区域
4. 可选择添加标注
5. 确认并导出最终图像

### 4.3 标注编辑流程
1. 截图完成后进入标注模式
2. 选择标注工具（矩形/箭头/文本）
3. 在截图上绘制或输入标注
4. 调整标注属性（颜色、大小等）
5. 支持撤销/重做操作
6. 完成后导出带标注的图像

---

## 5. 验收标准

### 5.1 功能验收
- [ ] 可以成功执行各种截图模式
- [ ] 交互式选择器工作正常
- [ ] 标注功能完整可用
- [ ] 支持多显示器环境
- [ ] 跨平台功能对等
- [ ] 导出功能正常工作

### 5.2 性能验收
- [ ] 各项性能指标满足要求
- [ ] 标注操作流畅
- [ ] 大尺寸截图处理正常
- [ ] 内存使用合理

### 5.3 稳定性验收
- [ ] 连续使用无崩溃
- [ ] 多平台稳定运行
- [ ] 错误场景优雅处理

---

## 6. 发展规划

### 6.1 短期计划 (v0.2)
- 完善 Windows 平台实现
- 增强多显示器体验
- 添加高级标注功能

### 6.2 中期计划 (v0.3)
- 标注编辑器 UI
- 历史记录管理
- 性能优化

### 6.3 长期计划 (v1.0)
- 插件系统
- 云同步功能
- API 接口开放