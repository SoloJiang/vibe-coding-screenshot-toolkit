# api_cli 模块技术设计

## 职责
提供交互式截图的命令行入口，专注于多### 多显示器工作流程
1. **虚拟桌面检测**：自动检测多显示器环境和虚拟桌面布局
2. **全局背景捕获**：使用 `capture_all()` 获取完整虚拟桌面截图作为背景
3. **跨屏交互启动**：创建跨越所有显示器的全屏选择窗口
4. **真实背景显示**：在选择界面中显示所有显示器的真实内容
5. **自由区域选择**：用户可以在任意显示器上看到并选择任意区域
6. **智能截图处理**：根据选择区域智能进行图像裁剪
7. **结果输出**：保存文件并可选复制到剪贴板能。

## 能力
- ✅ **交互式截图**：通过 `capture-interactive` 命令提供完整的多显示器框选截图
- ✅ **多显示器支持**：自动检测并支持跨显示器的区域选择
- ✅ **文件导出**：支持自定义输出目录和文件名模板
- ✅ **剪贴板集成**：可选择性地将截图复制到系统剪贴板
- ✅ **跨平台兼容**：通过条件编译支持 macOS 和 Windows（Windows 为占位实现）

## 命令
- **capture-interactive**：交互式框选截图，支持多显示器环境和跨显示器选择

### 交互式截图命令详细
- **功能**：启动 GUI 框选器，用户选择区域后自动截图并保存
- **多显示器支持**：
  - 自动检测多显示器环境并构建虚拟桌面坐标系
  - 在主显示器上进行交互选择
  - 支持跨显示器区域选择和智能截图合成
- **输出选项**：
  - 文件导出：支持自定义输出目录和命名模板
  - 剪贴板：可选的 `--clipboard` 参数直接复制到剪贴板
- **格式**：输出 PNG 格式图片

### 命令参数
```bash
capture-interactive [OPTIONS]

OPTIONS:
  -d, --out-dir <DIR>     输出目录 [默认: .]
  -t, --template <STR>    文件名模板 [默认: Screenshot-{date:yyyyMMdd-HHmmss}-{seq}]
      --clipboard         同时复制到剪贴板
```

### 命名模板
支持以下变量：
- `{date}`: 日期时间戳，支持自定义格式
- `{seq}`: 自动递增序列号
- 示例：`Screenshot-{date:yyyyMMdd-HHmmss}-{seq}` → `Screenshot-20240921-143022-001.png`

## 多显示器工作流程
1. **环境检测**：自动检测多显示器环境和虚拟桌面布局
2. **交互启动**：在主显示器上启动选择器界面
3. **区域选择**：用户可以选择跨越多个显示器的任意区域
4. **智能截图**：
   - 单显示器区域：直接从对应显示器裁剪
   - 跨显示器区域：合成虚拟桌面后裁剪
5. **结果输出**：保存文件并可选复制到剪贴板

## 输出
- **成功时**：显示保存路径和剪贴板状态
- **失败时**：显示详细错误信息和建议
- **退出代码**：0=成功，1=导出失败，2=交互取消，3=平台不支持

## 设计简化
基于用户需求，专注于单一核心功能：
- ✅ **交互式多显示器框选截图**
- ❌ 移除全屏截图 (`capture`)
- ❌ 移除多显示器全屏 (`capture-all`)
- ❌ 移除区域截图 (`capture-region`)
- ❌ 移除历史管理功能

## 风险
| 风险 | 缓解 |
|------|------|
| 终端权限/屏幕录制权限不足 | 明确报错并提示授权路径 |
| 用户取消交互 | 友好的退出消息和退出代码 |
| 多显示器坐标错位 | 通过虚拟桌面坐标系统统一处理 |
